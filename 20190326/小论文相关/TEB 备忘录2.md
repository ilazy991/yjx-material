**摘要**：
~~提出了用于最优控制问题的一般轨迹规划器并将其应用于机器人系统。该方法基于定时弹性带和非线性模型预测控制。通过利用底层优化问题中的稀疏性，可以显着减少计算工作量，从而产生具有实时能力的计划器。此外，采用基于定位的切换策略来实现收敛和稳定性。计划程序在使用真实SCARA型机器人的机器人应用程序中说明。~~

#### 第一节 Introduction
实时轨迹规划是机器人系统运动控制的基本部分。通常使用有效的优化配方来实现系统的高度自治。通常，提出多目标问题以在诸如时间，能量，安全性或系统寿命的不同方面之间形成折衷。可以通过首先执行路径规划以找到几何路径来生成最佳轨迹，然后在第二步骤中确定沿着该路径的最佳轨迹。该方法被称为解耦方法[1] - [2] [3]，并且在[4]中示出了轨迹生成可以被公式化为可以有效求解的凸优化问题。

在许多工业应用中，路径不能与轨迹生成分离。例如，目标可以在不受机器人控制器控制的输送机上移动，障碍物也可以存在于机器人的工作空间中。因此，需要一种用于轨迹优化的组合方法。在[5]中，提出了一种技术，其中基于通过所谓的弹性带框架的传感器输入动态更新给定轨迹。连接起始状态和结束状态的轨迹产生初始弹性带，然后通过推断带上的虚拟力使其在障碍物周围变形。该技术可以实现实时防撞，同时保持几何路径尽可能短。但是，系统动力学不能轻易地包含在traiectory规划中。

在[6]和[7]中扩展了弹性带的概念，其中包括姿势之间的时间间隔以形成所谓的定时弹性带（TEB）。包含时间信息使得可以考虑系统动态并优化时间。轨迹规划问题被建模为多目标优化问题，其中通过目标中的罚函数引入碰撞避免和系统动力学，同时还旨在最小化过渡时间。最近，在[8]中，定时弹性带概念应用于MPC设置。与[8]相比，目前的工作涉及实时性能方面，并包括最终目标的变化。

这项工作的主要贡献是在动态环境中运行的非线性系统的在线轨迹优化的一般框架。重塑策略是[8]的扩展，定时弹性带框架与非线性模型预测控制（NMPC）技术相结合，以实现准时间最优轨迹。此外，利用了潜在优化问题的稀疏性。这允许计算上有效地实现解决方案。当系统被驱动到某个目标状态时，还采用新颖的切换策略来实现收敛和稳定性。

第二节概述了轨迹规划程序。第三节简要介绍了该框架的软件实施，然后是第四部分，其中规划者被用于各种模拟实例。最后，第五节得出结论并列出未来可能的工作。

#### 第二节轨迹规划过程
A.问题制定
在一般设置中，目标是确定时间最优轨迹 ÿ（t ），给定系统动态，并计算控制信号 你（t ）实现轨迹所必需的。这里的任务表示为最优控制问题，
分你（。）ŤF ST 。⎧⎩⎨⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪X˙（t ）= f（x（t ），u（t ），t ）y（t）=g（x（t ），u（t ））X（吨）∈ XŤÙ（吨）∈ ùŤÝ（吨）∈ ÿŤφ0（x（t0），你（t0），y（t0），t0）= 0φF（x（tF），你（tF），y（tF），tF）= 0（1）
查看来源右键单击MathML和其他功能的图。 哪里 X ∈ řp，ü ∈ [R q，和 ÿ∈ [R[R。假设可行区域由集合组成XŤ，你 Ť 和 ÿŤ可以表示为非线性等式和不等式约束的有限集合。还假设问题具有固定的终点，如最后两个等式所示。在这里，重点是时间最优轨迹，但其他目标很容易包括在内。

B.定时弹性带表示
考虑状态向量和输入的离散化，由
x： = { x1，x2，... ，xñ} ，你： = { u1，你2，... ，你n - 1} ，
查看来源右键单击MathML和其他功能的图。 其中索引1到 ñ 表示时间实例，有限时间差由下式给出 Δ Ť。注意ñ 和 Δ Ť 当频带随时间变形时，允许变化。 ñ 将在某些预定义之间受限制 ñ¯米我Ñ 和 ñ¯m a x，而 Δ Ť 必须满足 Δ Ť> 0。离散状态和输入受近似系统动力学的约束，通过前向差异获得，Xk + 1- xķΔ Ť= f（xķ，你ķ）。假设是Δ Ť保持较小，使得等效采样频率足够高以具有稳定的积分。在实践中，这会对其施加额外的约束ñ¯米我Ñ上面介绍过。根据[8]的符号，状态和输入序列以及时间差被集中到所谓的定时弹性带（TEB）集中乙⊆ [Rd 哪里 d= n p + （n - 1）q+ 1，
乙：= { x1，你1，x2，你2，... ，xn - 1，你n - 1，xñ， Δ Ť} 。
查看来源右键单击MathML和其他功能的图。

该组构成了TEB，现在可以在空间和时间上变形，同时旨在满足每个状态之间的近似系统动态。

现在可以在TEB框架中将一般轨迹规划问题（1）重写为非线性优化问题：
分乙（Ñ - 1 ）Δ ŤST 。Xk + 1- xķΔ Ť- f（xķ，你ķ）= 0Xķ∈ Xķüķ∈ üķG（xķ，你ķ）∈ ÿķφ小号（x1，你1，g（x1，你1））= 0φF（xñ，你ñ，g（xñ，你ñ））= 0Δ Ť> 0 ，ķ ∈ [ 1 ，Ñ - 1 ] （2）
查看来源右键单击MathML和其他功能的图。 对于固定的 ñ¯米我Ñ≤ ñ ≤ ñ¯m a x。如果反比关系，上述公式可以进一步简化，Xķ= g- 1（ÿķ，你ķ），是可用的。在这种情况下，约束和端点的等式ÿķ 完全可以写成 Xķ 和 üķ，请注意，由于每个约束的离散化方案 ķ 通常只涉及相邻点，导致稀疏优化问题。

基于TEB的非线性模型预测控制的轨迹变形
应该快速获取优化解决方案以实现实时性能。因此，通常不可能在每个轨迹更新中确定全局解。相反，目标是确定一个可行的轨迹，该轨迹可以通过采用NMPC在后续迭代期间得到改善。在每个控制循环期间，通过迭代优化方法改进当前轨迹，然后仅将第一状态和输入用作控制动作。在下一个周期中，直接从传感器读数或状态估计获得当前状态。

轨迹规划器将当前计划的轨迹存储为TEB集 乙*。在每个控制循环期间，轨迹首先在时间上变形，然后在空间中变形。初始轨迹简单地确定为起始状态和目标状态之间的线性插值。

1）时间变形
定时松紧带的长度， 乙*，如[8]中所建议的那样，将根据简单的决策规则进行变化。让Δ Ť¯r e f 表示与采样时间相关的预定义参考时间并定义 Δ Ť¯H ÿ小号Ť≈ 0.1 Δ Ť¯r e f在更新期间避免振荡。请参阅算法1，其中概述了完整更新。因此，预测的总时间不应改变Δ Ť我+ 1ñ我+ 1= Δ Ť一世ñ一世。插入新状态将减少Δ Ť， 称为是 Ç ø Ñ 吨ř 一个ç 吨我Ñ 克及时。同样，删除状态也会增加Δ Ť， 定义为 e x p a n d我Ñ 克及时。在每个控制周期期间，TEB更新是预定义的一世¯ŤË乙次数。TEB集的完整长度乙*我+ 1 更新后， d¯= n我+ 1p + （n我+ 1- 1 ） q+ 1。因此，（2）每次迭代的变化。为了增加保留可行性的机会，在TEB更新之间线性地重新插入轨迹。

2）空间变形
在更新轨迹的长度之后，将针对当前值求解（2）的一些变化ñ。使用顺序二次规划（SQP）解决每个非线性优化问题。SQP Solver运行预定义的一世¯小号Q P.每次TEB更新后的迭代次数。因此，每个控制周期执行的完整数量的优化迭代由下式给出一世¯ŤË乙⋅ 我¯小号Q P.。

使用SQP需要对目标的衍生评估和（2）的约束。在这里，梯度，Hessians和lacobians是通过自动分化获得的[9]。这些方法还可以使用图着色技术确定Hessians和Jacobians的稀疏模式。稍后在SQP过程中使用稀疏信息。除了存储器节省和有效的矩阵向量运算之外，在求解二次子问题时可以使用有效的稀疏因子分解。这是[8]中工作的重要延伸，其中没有探讨问题的稀疏性。没有探索稀疏性，就无法实现实时性能。

D.通过转换策略实现融合和稳定
无法保证此处描述的次优规划方法总是产生成功收敛到目标状态的轨迹，也不能稳定目标系统。此外，随着接近目标状态，可能出现数值不稳定性Δ Ť 会接近零。

算法1：轨迹变形
算法 
已经表明，在一些温和条件下，次优模型预测控制器正在稳定[10]。简而言之，只要保持可行性，国家就会转向终端状态。其中一个条件是在每次迭代期间，目标有足够的减少，在[10]中通过假设二次目标函数来确保。

为了在这里介绍的方法中利用这些想法，提出了一种切换策略。当系统足够接近目标时，基础优化问题被修改为优化问题
Σk = 1n - 1∥ Xķ- xF∥2
查看来源右键单击MathML和其他功能的图。最小化以实现收敛。注意固有的采样时间Δ Ť¯š 一米p 升ë用于跟踪配方。这是为了确保时间变形不会破坏二次公式的收敛性。作为选择，在小区域中，稳定区域可以使用线性LQR控制器。

策略切换发生的区域的大小取决于应用程序。简单的应用程序可以在规划期间的主要部分使用准时间最优策略。相反，更难的问题可能需要更加保守的条件来切​​换以强制收敛和稳定。

E.多个轨迹
由于基础优化问题通常是非凸的，因此解决方案通常是局部最优并且将取决于初始轨迹猜测。因此，提供多个起始猜测以并行地启动多个计划程序。由于规划程序是独立的，只要轨迹的数量不超过可用处理元素的数量，它们就可以并行有效地计划。这里通过初始状态和目标状态之间的线性插值生成初始开始猜测。多个终端目标是从解决方案创建的G- 1（ÿķ，你ķ）在（1）中。在每个控制循环期间，计划者在轨迹候选者中选择并应用相应的控制。这里，选择规则只是选择具有当前最佳目标值的轨迹。随着一条轨迹的遍历，随着其他候选人变得更加不适应，转换将不太可能发生。因此，当目标间隙变大时，规划者最终可以承诺轨迹，并且放弃其他候选者以释放计算资源。

第三节履行
完整的轨迹优化过程被压缩为实时算法，如算法2所示。求解器在C ++中实现为面向对象的软件包。最值得注意的类是TrajectoryPlanner，TEBSolver和SQPSolver。TrajectoryPlanner管理规划程序并为最终用户提供API。TEBSolver负责变形轨迹，轨迹内部存储在数据类型TimedElasticBand中。SQPSolver是用于非线性优化问题的通用求解器，TEBSolver使用它来改善轨迹。

该软件包使用了多个第三方库。Eigen [11]，用于矩阵/向量存储和线性代数运算。小号p È Ç 吨ř 一个 [12]，对于建立在Eigen上的 大尺度特征值问题。qpOASES [13]，用于解决SQP过程中出现的二次子问题。HSL_MA57 [14]在qpOASES内部使用，以有效地求解稀疏对称线性系统。最后，Cp p A D [15]，用于计算衍生信息以及Hessians和Jacobians的稀疏模式。

第四节模拟测试
使用参数在模拟中评估计划过程 一世¯ŤË乙= 我¯小号Q P.= 2 和 Δ Ť¯š 一米p 升ë= Δ Ť¯r e f= 0.05秒。模拟使用Julia [16]编程语言。具体而言，使用了文库[17]，[18]和[19]。所有模拟均在四核Intel（R）Core（TM）i7-6600U CPU @ 2.60GHz处理器上进行。

一个模型
在模拟中使用SCARA型平面弯头机器人。该模型由两个具有旋转关节角度的链节组成，q1 和 q2。状态变量，x = （q1，q2，q˙1，q˙2）Ť。输出，ÿ，是由前向运动学提供的末端执行器的笛卡尔坐标 ÿ= χ （q1，q2）。运动的动力学方程由下式给出，
中号（q1，q2）（q¨1q¨2） +C.（q˙1，q˙2）（q˙1q˙2） +（c1q˙1C2q˙2） =（τ1τ2），
查看来源右键单击MathML和其他功能的图。 惯性矩阵在哪里 中号（q1，q2） 以及向心和科里奥利术语 C（q˙1，q˙2）可以通过分析力学获得。线性摩擦术语C1 和 C2也包括在模型中，参数值在表I中提供。右侧包含扭矩矢量τ（t ）用作控制变量。有关Planar Elbow模型的详细介绍，请参见[20]。

图1
图。1：
灰色三角形代表末端效应器，它被移动到目标位置。红色路径是每个时间范围内的计划路径。实现的轨迹以黑色显示。

查看全部

图2
图2：
在模拟计划过程中重新计算轨迹所需的计算时间。相应图中的实线是当利用稀疏信息时，虚线对应于将问题视为密集的。

查看全部

表I：平面肘模型的参数值
表I：
B.简单动作
在第一个简单示例中，任务是将末端效应器从起点移动到终点。这里，跟踪附近的半径设定为20mm，稳定性附近的半径设定为5mm。由此产生的规划程序和实现的轨迹如图1所示。状态（关节角度和关节速度）轨迹和施加的控制信号如图3所示。控制信号具有bang-bang性质，这表示准时间最优性，直到切换到跟踪发生。跟踪程序和稳定控制的组合成功地使末端执行器在目标位置停止。第二关节角度具有较大的过冲和较不平滑的控制信号，这是预期的，因为交叉耦合使得第二臂更难控制。所需计算时间的测量结果如图2a所示。

在主要计划过程期间，允许轨迹长度以及因此基础优化问题的大小变化。因此，重新计算轨迹所需的计算时间在控制周期之间变化。切换到跟踪控制后，问题大小是固定的，计算时间不会改变。在稳定控制的最后阶段，计划员使用已经计算的LQR反馈，并且所需的时间几乎不可察觉。通过利用问题中的稀疏性，计算时间减少了3倍。值得注意的是，所需的计算时间决不会超过采样时间，这表明该过程对于实时控制是可行的。

图3
图3：
SCARA机器人手臂的轨迹规划程序。虚线垂直线表示控制策略何时从准时间最佳切换到跟踪，以及从跟踪到稳定LQR控制。

查看全部

算法2：轨迹规划
算法 
C.带有障碍的环境中的运动
现在，引入了三个障碍，使规划问题更加复杂。为简单起见，机器人手臂被视为放置在障碍物上方的高度，不会碰撞。然而，固定在末端执行器上的工具向下到达较低水平并且可能与障碍物碰撞。此外，障碍物被建模为末端执行器不能穿过的圆形区域。

通过在计划轨迹上的每个点上引入足够接近任何障碍的惩罚性术语，可以将障碍避免包括在规划框架中。在更近的距离处，使用硬约束来确保不发生碰撞。这些距离也构成输入到计划器的配置参数。在这些例子中，稳定性附近的半径设定为0.1mm。

得到的规划程序和实现的轨迹如图4所示。在这里，规划者没有成功地将初始猜测变形为无碰撞路径。如果稍微调整配置参数，规划器可能会成功。然而，这里的方法是采用第II-E节中描述的多轨迹程序。如果计划者提供了4种不同的起始猜测，则得到的计划程序和实现的轨迹如图5所示。

现在，由于规划者可以同时探索4条不同的路径，因此它成功地确定了无碰撞轨迹。请注意，计划程序在0.4秒后才会进入轨迹。所需的计算时间如图2b所示。值得注意的是，在轨迹候选者中进行选择的开销仅在初始迭代中是明显的。在提交到轨迹之后，解决方案时间与简单方案相当。

第五节结论和未来的工作
解决了一般的轨迹规划问题。此处介绍的过程能够重新构建响应传感器输入和避障的路径。通过允许基础优化公式改变每个控制周期，该路径被采用到环境中。所提出的方法依赖于不同的阶段。第一阶段涉及基于TEB的NMPC方法，该方法产生准时间最优解。第二阶段采用跟踪公式，其目标是最小化到目标的距离。最后，在可选的最后阶段，反馈控制器使用LQR稳定系统。提供了与机器人轨迹规划和控制相关的许多不同场景以激励使用，但是可能的应用不限于机器人操纵器。在仿真中，表明可以实现真实的机器人模型的实时性能。实现性能的关键是利用问题中的稀疏性，在这种情况下，计算时间减少了3倍。

未来的工作有几个方向。通过在嵌入式设置中使用所呈现的过程来控制真实机器人，可以进一步评估实时能力。另一个想法是研究潜在的非线性优化问题的替代解决方案方法。例如，在[21]中引入了基于信任域的SQP方法。，通过扰动过程保证优化迭代是可行的。另一个方向可能是调查更复杂的TEB更新。如果存在障碍物，则规划者可以添加更多状态，而不是每个周期一个，以更快地将轨迹分辨率改变到合适的水平。同样，如果路径清晰，则可以以更快的速率移除状态以达到足以用于规划轨迹的剩余部分的原始分辨率。通过使用更复杂的猜测也可以改善轨迹的初始化。一种想法可能是首先采用有效的两步法生成初始可行轨迹。通过采用概率路线图方法可以获得初始无碰撞路径[22]结合处理多个轨迹，类似于[7]中提出的方法。

图4
图4：
以3个圆形障碍物为例的结果。灰色三角形表示末端效应器，其朝向目标位置移动但与其中一个障碍物碰撞。计划的轨迹为红色，实现的轨迹为黑色。

查看全部

图5
图5：
在计划多个轨迹时，示例中有3个圆形障碍物的结果。灰色三角形表示末端执行器，其朝向目标位置移动而不与障碍物碰撞。计划的轨迹以ref显示，实现的轨迹以黑色显示。并行计划的替代轨迹以蓝色显示。